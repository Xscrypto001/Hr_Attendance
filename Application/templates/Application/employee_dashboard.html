{% extends 'Application/base.html' %}
{% load static %}
{% block content %}

<script src="https://cdn.tailwindcss.com"></script>
<style>
    .progress-ring {
      position: relative;
      width: 100px;
      height: 100px;
    }
    .progress-ring circle {
      fill: none;
      stroke-width: 8;
      transform: rotate(-90deg);                                                                      
transform-origin: 50% 50%;
    }
    .progress-ring__bg {
      stroke: #e5e7eb;
    }
    .progress-ring__value {
      stroke-linecap: round;
    }                                                                                             


.</style>
<div class="container mt-5">
    <h1 class="text-black">Welcome, {{ user.first_name }} {{ user.last_name }}</h1>
    <p class="text-muted">Department: {{ department }}</p>

<div className="bg-orange-600">
<a href="{% url 'leave_balances' %}"
   class="inline-block px-6 bg-orange-500  py-3 text-white font-semibold text-lg rounded-full shadow-lg transition duration-300 ease-in-out bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 hover:scale-105 hover:shadow-2xl">
   ðŸ“Š View Leave Balances
</a>
</div>


<!--<div class="bg-white shadow-lg rounded-lg p- w-full">
  <h2 class="text-xl font-semibold text-gray-800 mb-6">Leave Balances</h2>
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6">
    {% for leave in leave_data %}
    <div class="bg-white shadow rounded-lg flex flex-col items-center p-4">
      <div class="progress-ring">
        <svg width="100" height="100">
          <circle class="progress-ring__bg" r="45" cx="50" cy="50"/>
          <circle class="progress-ring__value"
            r="45" cx="50" cy="50"
            stroke="{{ leave.color }}"
            stroke-dasharray="283"
            stroke-dashoffset="{{ leave.stroke_offset }}"
          />
        </svg>
        <span class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-lg font-bold text-gray-700">
          {{ leave.balance }} days
        </span>
      </div>
      <p class="mt-3 text-gray-600 font-medium">{{ leave.name }}</p>
    </div>
    {% endfor %}
  </div>
</div>-->



<!--<div class="bg-white shadow-lg rounded-lg p-6 w-full max-w-5xl">
    <h2 class="text-xl font-semibold text-gray-800 mb-6">Leave Balances</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6">

      {% for leave in leave_data %}
      <div class="bg-white shadow rounded-lg flex flex-col items-center p-4">
        <div class="progress-ring">
          <svg width="100" height="100">
            <circle class="progress-ring__bg" r="45" cx="50" cy="50"/>
            <circle class="progress-ring__value"
    r="45" cx="50" cy="50"
    stroke="{{ leave.color }}"
    stroke-dasharray="283"
    stroke-dashoffset="{{ leave.stroke_offset }}"
/>

          </svg>
          <span class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-lg font-bold text-gray-700">
            {{ leave.balance }} days
          </span>
        </div>
        <p class="mt-3 text-gray-600 font-medium">{{ leave.name }}</p>
      </div>
      {% endfor %}

    </div>-->



    <!-- My Leaves -->
    <h2 class="text-light mt-4">My Leaves</h2>
    <div class="table-responsive bg-dark p-3 rounded shadow-sm">
        <table class="table table-dark table-striped">
            <thead>
                <tr>
                    <th>Leave Type</th>
                    <th>From</th>
                    <th>To</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for leave in my_leaves %}
                <tr>
                    <td>{{ leave.leave_type }}</td>
                    <td>{{ leave.start_date }}</td>
                    <td>{{ leave.end_date }}</td>
                    <td>{{ leave.final_status }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center text-muted">No leave records found</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Leave Balances with Donut Graphs -->
    <h2 class="text-light mt-5">My Leave Balances</h2>
    <div class="row">
        {% for balance in leave_balances %}
        <div class="col-md-4 mb-4">
            <div class="card bg-dark text-white shadow-sm h-100">
                <div class="card-body text-center">
                    <h5 class="card-title">{{ balance.type }}</h5>
                    <canvas id="chart-{{ forloop.counter }}"></canvas>
                    <p class="mt-3">
                        <strong>Allowed:</strong> {{ balance.allowed }} days<br>
                        <span class="text-success"><strong>Remaining:</strong> {{ balance.remaining }} days</span><br>
                        <span class="text-warning"><strong>Used:</strong> {{ balance.used }} days</span>
                    </p>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12 text-center text-muted">
            No leave balance data available
        </div>
        {% endfor %}
    </div>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    {% for balance in leave_balances %}
    new Chart(document.getElementById("chart-{{ forloop.counter }}"), {
        type: 'doughnut',
        data: {
            labels: ['Used', 'Remaining'],
            datasets: [{
                data: [{{ balance.used }}, {{ balance.remaining }}],
                backgroundColor: ['#ffc107', '#28a745'],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'bottom', labels: { color: 'white' } },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.label + ': ' + context.parsed + ' days';
                        }
                    }
                }
            }
        }
    });
    {% endfor %}
</script>

{% endblock %}
